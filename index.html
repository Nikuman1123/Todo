<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>ToDoApp</title>
    <link rel="stylesheet" href="style.css" />
    <!-- M PLUS Rounded 1cã‚’è¨­å®šã™ã‚‹ -->
    <link
      href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c&display=swap"
      rel="stylesheet"
    />
    <!-- Font Awesome CDNï¼ˆv6ï¼‰ -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <!-- <link rel="stylesheet" href="all.css" /> -->
  </head>
  <body>
    <h1>ToDo</h1>
    <input type="text" id="taskInput" placeholder="ã‚¿ã‚¹ã‚¯ã‚’å…¥åŠ›" />
    <input type="date" id="dueDate" />
    <select id="priority">
      <option value="normal" selected>normal</option>
      <option value="high">high</option>
      <option value="low">low</option>
    </select>
    <button id="addBtn" class="addBtn">Add</button>
    <button id="toggleTheme">â˜€ï¸ / ğŸŒ™</button>
    <br />
    <p
      id="errorMsg"
      class="error-message"
      style="color: crimson; display: none"
    ></p>
    <button id="toggleSort" class="sort-button sort-asc">Sort by Date</button>
    <button id="showAll" class="filter-button">All</button>
    <button id="showActive" class="filter-button">Active</button>
    <button id="showCompleted" class="filter-button">Completed</button>
    <button id="clearCompleted" class="delete-btn hidden">
      Clear Completed
    </button>

    <ul id="taskList">
      <!-- JavaScriptã§liã‚’è¿½åŠ  -->
    </ul>
    <script>
      const taskInput = document.getElementById('taskInput');
      const dueDateInput = document.getElementById('dueDate');
      const taskList = document.getElementById('taskList');
      const clearCompletedBtn = document.getElementById('clearCompleted');
      let weatherList = [];
      let currentFilterType = 'all'; //ç¾åœ¨ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼çŠ¶æ…‹ä¿æŒ

      // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã®å‹•ä½œ
      // ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
      document.addEventListener('DOMContentLoaded', () => {
        // ãƒ†ãƒ¼ãƒã®å¾©å…ƒ
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.body.classList.add(savedTheme);

        // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼åˆæœŸåŒ–ï¼ˆAllãƒœã‚¿ãƒ³ã‚’é¸æŠçŠ¶æ…‹ã«ã™ã‚‹ï¼‰
        updateFilterButtons('showAll');

        // ã‚¿ã‚¹ã‚¯å…¥åŠ›æ¬„ã«è‡ªå‹•ãƒ•ã‚©ãƒ¼ã‚«ã‚¹;
        taskInput.focus();

        // ãŠå¤©æ°—ã¨ã‚¿ã‚¹ã‚¯ã®å¾©å…ƒ
        getWeather().then(() => {
          restoreTasksFromLocalStorage();
          pressFilterButtons('all'); // â† è¡¨ç¤ºçŠ¶æ…‹ã‚‚Allã«ã™ã‚‹
        });
        sortTasks('asc');

        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ç¾åœ¨æ—¥ä»˜ã‚’ã‚»ãƒƒãƒˆã™ã‚‹
        dueDateInput.value = getTodayDate();
      });

      // Escã‚­ãƒ¼ã§å…¥åŠ›ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          taskInput.value = '';
          dueDateInput.value = '';
        }
      });

      // å®Œäº†æ¸ˆã¿ã®ã‚¿ã‚¹ã‚¯ã‚’ã™ã¹ã¦å‰Šé™¤
      document
        .getElementById('clearCompleted')
        .addEventListener('click', () => {
          const isConfirmed = confirm(
            'å®Œäº†æ¸ˆã¿ã®ã‚¿ã‚¹ã‚¯ã‚’å…¨ã¦å‰Šé™¤ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ'
          );
          if (!isConfirmed) return;
          let hasRemoved = false;
          const allLis = document.querySelectorAll('#taskList li');
          allLis.forEach((li) => {
            const checkbox = li.querySelector('input[type="checkbox"]');
            if (checkbox && checkbox.checked) {
              // å‰Šé™¤æ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åŠ ãˆã‚‹
              // 0.3ç§’å¾Œã«å®Ÿéš›ã«å‰Šé™¤
              fadeAndRemove(li);
              hasRemoved = true;
            }
          });

          // æœ€å¾Œã«ã¾ã¨ã‚ã¦ä¿å­˜
          setTimeout(() => {
            if (hasRemoved) {
              saveTasksToLocalStorage();
              // Clear Completedãƒœã‚¿ãƒ³ã®è¡¨ç¤ºè¨­å®š
              updateClearCompletedVisibility();
            }
          }, 300);
        });

      // ã‚½ãƒ¼ãƒˆé †åˆ‡æ›¿
      let isAscending = true; // åˆæœŸã¯æ˜‡é †ï¼ˆtrueï¼‰
      const toggleSortBtn = document.getElementById('toggleSort');
      toggleSortBtn.addEventListener('click', () => {
        isAscending = !isAscending; //çŠ¶æ…‹ã‚’åè»¢
        const newOrder = isAscending ? 'asc' : 'desc';
        toggleSortBtn.classList.toggle('sort-asc', isAscending);
        toggleSortBtn.classList.toggle('sort-desc', !isAscending);
        // toggleSortBtn.textContent = `Sort by Date ${isAscending ? 'â†‘' : 'â†“'}`;
        sortTasks(newOrder);
      });

      // ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ
      const toggleBtn = document.getElementById('toggleTheme');
      toggleBtn.addEventListener('click', () => {
        // ãƒ¢ãƒ¼ãƒ‰ã®ä¿å­˜
        const isDark = document.body.classList.contains('dark');
        const nextTheme = isDark ? 'light' : 'dark';

        document.body.classList.remove('light', 'dark');
        document.body.classList.add(nextTheme);

        localStorage.setItem('theme', nextTheme);
      });

      // Addãƒœã‚¿ãƒ³æŠ¼ä¸‹
      const addBtn = document.getElementById('addBtn');
      addBtn.addEventListener('click', () => {
        const taskText = taskInput.value;
        const dueDate = dueDateInput.value;

        if (!validateTaskInput(taskText, dueDate)) return;

        addTask(undefined, undefined, false, undefined);
        saveTasksToLocalStorage();
        sortTasks('asc');
      });

      // å¤‰æ›é€”ä¸­ã®ã‚¨ãƒ³ã‚¿ãƒ¼æŠ¼ä¸‹ã˜ã‚ƒãªã„ã‹ãƒã‚§ãƒƒã‚¯
      let isComposing = false;
      taskInput.addEventListener('compositionstart', () => {
        isComposing = true;
      });
      taskInput.addEventListener('compositionend', () => {
        isComposing = false;
      });

      // ç¢ºå®šå¾Œã®ã‚¨ãƒ³ã‚¿ãƒ¼ã‚­ãƒ¼æŠ¼ä¸‹ã‚’æ¤œçŸ¥ã™ã‚‹
      taskInput.addEventListener('keydown', function (e) {
        if (e.key === 'Enter' && !isComposing) {
          const taskText = taskInput.value;
          const dueDate = dueDateInput.value;

          if (!validateTaskInput(taskText, dueDate)) return;
          addTask(undefined, undefined, false, undefined);
          saveTasksToLocalStorage();
          sortTasks('asc');
        }
      });

      // ADDãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸæ™‚ã®å‡¦ç†ã‚’é–¢æ•°ã¨ã—ã¦è¨˜è¿°ã€‚
      function addTask(taskTextArg, dueDateArg, isDone = false, priorityArg) {
        const taskText =
          typeof taskTextArg === 'string' ? taskTextArg : taskInput.value;
        const dueDate = dueDateArg || document.getElementById('dueDate').value;

        if (taskText.trim() === '') {
          return; // å…¥åŠ›ãŒç©ºã®å ´åˆã¯ä½•ã‚‚ã—ãªã„
        }
        taskInput.value = '';
        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ç¾åœ¨æ—¥ä»˜ã‚’ã‚»ãƒƒãƒˆã™ã‚‹ãŸã‚ã€æœŸé™æ—¥ã®ãƒªã‚»ãƒƒãƒˆã‚’å‰Šé™¤
        // document.getElementById('dueDate').value = '';

        // liã¯å·¦å³ã§divã‚’åˆ†å‰²ã€ãƒ†ã‚­ã‚¹ãƒˆã¯spanã¸
        const li = document.createElement('li');
        const leftDiv = document.createElement('div');
        leftDiv.classList.add('left');
        const rightDiv = document.createElement('div');
        rightDiv.classList.add('right');
        const textSpan = document.createElement('span');

        // ã‚¿ã‚¹ã‚¯ã®å„ªå…ˆåº¦ã‚’è¨­å®š
        const priorityInput = document.getElementById('priority');
        const priority = priorityArg ?? priorityInput.value;
        li.classList.add(`priority-${priority}`);

        // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’è¨­å®š
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.checked = isDone; // â† ã“ã‚Œã‚’è¿½åŠ ï¼
        checkbox.addEventListener('change', () => {
          // if (checkbox.checked) {
          //   li.style.textDecoration = 'line-through';
          // } else {
          //   li.style.textDecoration = 'none';
          // }

          // ãƒã‚§ãƒƒã‚¯ã—ãŸæ™‚ã®å–ã‚Šæ¶ˆã—ç·šã‚’classListã§å®Ÿç¾
          li.classList.toggle('completed', checkbox.checked);

          // LocalStorageä¿å­˜
          saveTasksToLocalStorage();
          // Clear Completedãƒœã‚¿ãƒ³ã®è¡¨ç¤ºè¨­å®š
          updateClearCompletedVisibility();
        });

        // åˆæœŸè¡¨ç¤ºã§ã‚‚ç·šã‚’å¼•ã
        // li.style.textDecoration = isDone ? 'line-through' : 'none';
        // classListã‚’ä½¿ç”¨ã—ã¦ãƒã‚§ãƒƒã‚¯æ¸ˆã¿ã®ãƒªã‚¹ãƒˆã‚’å¾©å…ƒã™ã‚‹
        if (isDone) {
          li.classList.add('completed');
        }

        // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’è¿½åŠ 
        leftDiv.appendChild(checkbox);

        // ã‚¿ã‚¹ã‚¯ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’è¿½åŠ 
        textSpan.classList.add('taskText');
        textSpan.textContent = taskText;

        // const dueDateInput = document.getElementById('dueDate');
        // const dueDate = dueDateInput.value;
        if (dueDate !== '') {
          const dateObj = new Date(dueDate);
          const isValid = !isNaN(dateObj.getTime());

          if (!isValid) {
            alert('æ­£ã—ã„æ—¥ä»˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
            return;
          }

          // å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã®è¿½åŠ 
          const weatherSpan = document.createElement('span');
          weatherSpan.classList.add('weatherInfo');
          if (dueDate) {
            const matched = weatherList.find((item) => item.date === dueDate);
            if (matched) {
              weatherSpan.textContent = `${matched.emoji} ${matched.rain}%`;
              rightDiv.appendChild(weatherSpan);
            }
          }

          // æœŸé™æ—¥ã‚’è¿½åŠ 
          const dueDateSpan = document.createElement('span');
          dueDateSpan.classList.add('dueDate');
          dueDateSpan.textContent = `ï¼ˆã€œ${dueDate}ï¼‰`;
          rightDiv.appendChild(dueDateSpan);
        }

        // ãƒ†ã‚­ã‚¹ãƒˆã‚’è¿½åŠ 
        // li.appendChild(textSpan);
        leftDiv.appendChild(textSpan);

        // ãƒ‡ãƒªãƒ¼ãƒˆãƒœã‚¿ãƒ³ã®è¨­å®š
        const dlButton = document.createElement('button');
        dlButton.classList.add('delete-btn');
        dlButton.textContent = 'del';

        // ãƒ‡ãƒªãƒ¼ãƒˆæŠ¼ä¸‹ã•ã‚ŒãŸã‚‰ãƒªã‚¹ãƒˆã‹ã‚‰å‰Šé™¤ã™ã‚‹
        dlButton.addEventListener('click', function () {
          //  fadingã‚¯ãƒ©ã‚¹ã‚’ä»˜ä¸ã—ã¦ãƒ•ã‚§ãƒ¼ãƒ‰é–‹å§‹ã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒçµ‚ã‚ã‚‹0.3ç§’å¾Œã«å‰Šé™¤
          fadeAndRemove(li, () => {
            // LocalStorageä¿å­˜
            saveTasksToLocalStorage();
            // Clear Completedãƒœã‚¿ãƒ³ã®è¡¨ç¤ºè¨­å®š
            updateClearCompletedVisibility();
          });
        });

        // ãƒ‡ãƒªãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’è¿½åŠ 
        rightDiv.appendChild(dlButton);

        // leftDivã¨rightDivã‚’liã«è¿½åŠ 
        li.appendChild(leftDiv);
        li.appendChild(rightDiv);

        // ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆã¨ã—ã¦è¿½åŠ 
        taskList.appendChild(li);

        // ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ ã—ãŸã¨ãã«å…¥åŠ›æ¬„ã¸è‡ªå‹•ã§ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’æˆ»ã™
        taskInput.focus();
        // Clear Completedãƒœã‚¿ãƒ³ã®è¡¨ç¤ºè¨­å®š
        updateClearCompletedVisibility();
        // // LocalStorageä¿å­˜
        // saveTasksToLocalStorage();
      }

      // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸæ™‚ã®å‹•ä½œ
      function pressFilterButtons(filterType) {
        const allTask = document.querySelectorAll('#taskList li');
        allTask.forEach((li) => {
          const checkbox = li.querySelector('input[type = checkbox]');
          if (filterType === 'all') {
            li.style.display = 'flex';
          } else if (filterType === 'active') {
            li.style.display = checkbox && checkbox.checked ? 'none' : 'flex';
          } else if (filterType === 'completed') {
            li.style.display = checkbox && checkbox.checked ? 'flex' : 'none';
          }
        });
      }

      function updateFilterButtons(activeButtonId) {
        const buttons = document.querySelectorAll('.filter-button');
        buttons.forEach((btn) => {
          btn.classList.remove('active');
        });
        const activeBtn = document.getElementById(activeButtonId);
        activeBtn.classList.add('active');
      }

      // ==== ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ² ==== //
      // å…¨è¡¨ç¤º
      document.getElementById('showAll').addEventListener('click', () => {
        currentFilterType = 'all';
        pressFilterButtons('all');
        updateFilterButtons('showAll');
      });
      // æœªå®Œäº†
      document.getElementById('showActive').addEventListener('click', () => {
        currentFilterType = 'active';
        pressFilterButtons('active');
        updateFilterButtons('showActive');
      });
      // å®Œäº†
      document.getElementById('showCompleted').addEventListener('click', () => {
        currentFilterType = 'completed';
        pressFilterButtons('completed');
        updateFilterButtons('showCompleted');
      });

      // ãŠå¤©æ°—ãƒ‡ãƒ¼ã‚¿ã®APIå–å¾—
      async function getWeather() {
        const url =
          'https://api.open-meteo.com/v1/forecast?latitude=34.6938&longitude=135.5011&daily=weather_code,precipitation_probability_max&timezone=Asia%2FTokyo';
        // 'https://api.open-meteo.com/v1/forecast?latitude=53.3331&longitude=-6.2489&daily=weather_code,precipitation_probability_max&timezone=auto';

        try {
          const response = await fetch(url);
          const weatherData = await response.json();
          console.log('å–å¾—æˆåŠŸ:', weatherData); // â† ã“ã“ã§ç¢ºèª
          editData(weatherData);
        } catch (error) {
          console.error('ã‚¨ãƒ©ãƒ¼å†…å®¹:', error); // â† ã‚¨ãƒ©ãƒ¼è©³ç´°ã‚’ç¢ºèª
        }
      }
      // ãŠå¤©æ°—ãƒ‡ãƒ¼ã‚¿ã®æ•´å½¢
      function editData(weatherData) {
        // weatherData.daily.time.forEach((date, i) => {
        //   const codes = weatherData.daily.weather_code[i];
        //   const rain = weatherData.daily.precipitation_probability_max[i];
        //   const emoji = getWeatherEmoji(codes);

        //   const weatherObj = {
        //     date,
        //     codes,
        //     emoji,
        //     rain,
        //   };

        //   weatherList.push(weatherObj);
        // });
        weatherList = weatherData.daily.time.map((date, i) => {
          const codes = weatherData.daily.weather_code[i];
          const rain = weatherData.daily.precipitation_probability_max[i];
          const emoji = getWeatherEmoji(codes);

          return { date, codes, emoji, rain };
        });

        console.log('æ•´å½¢å¾Œã®å¤©æ°—ãƒ‡ãƒ¼ã‚¿:', weatherList);
        // console.log(JSON.stringify(weatherList, null, 2));
      }

      function getWeatherEmoji(codes) {
        const emojiMap = [
          { codes: [0, 1], emoji: 'â˜€ï¸' },
          { codes: [2], emoji: 'â˜ï¸' },
          { codes: [3], emoji: 'â›…ï¸' },
          { codes: [45, 48], emoji: 'ğŸ˜¶â€ğŸŒ«ï¸' },
          { codes: [51, 56], emoji: 'â˜”ï¸ğŸ˜¶â€ğŸŒ«ï¸' },
          { codes: [53, 57], emoji: 'â˜”ï¸â˜”ï¸ğŸ˜¶â€ğŸŒ«ï¸' },
          { codes: [55], emoji: 'â˜”ï¸â˜”ï¸â˜”ï¸ğŸ˜¶â€ğŸŒ«ï¸' },
          { codes: [56, 57], emoji: 'ğŸŒ«ï¸ğŸ¥¶' },
          { codes: [61], emoji: 'â˜”ï¸' },
          { codes: [63], emoji: 'â˜”ï¸â˜”ï¸' },
          { codes: [65], emoji: 'â˜”ï¸â˜”ï¸â˜”ï¸' },
          { codes: [66, 67], emoji: 'â˜”ï¸ğŸ¥¶' },
          { codes: [71, 77, 85], emoji: 'â„ï¸' },
          { codes: [73], emoji: 'â„ï¸â„ï¸' },
          { codes: [75, 86], emoji: 'â„ï¸â„ï¸â„ï¸' },
          { codes: [80], emoji: 'â˜”ï¸â³' },
          { codes: [81], emoji: 'â˜”ï¸â˜”ï¸â³' },
          { codes: [82], emoji: 'â˜”ï¸â˜”ï¸â˜”ï¸â³' },
          { codes: [95], emoji: 'â˜”ï¸âš¡ï¸' },
          { codes: [96], emoji: 'ğŸ§Šâ˜”ï¸âš¡ï¸' },
          { codes: [99], emoji: 'ğŸ§ŠğŸ§Šâ˜”ï¸â˜”ï¸âš¡ï¸âš¡ï¸' },
        ];
        const match = emojiMap.find((entry) => entry.codes.includes(codes));
        return match ? match.emoji : '?';
      }
      // LocalStorageä¿å­˜ç”¨é–¢æ•°
      function saveTasksToLocalStorage() {
        const allLis = document.querySelectorAll('#taskList li');
        const taskData = [];
        allLis.forEach((li) => {
          const checkbox = li.querySelector('input[type="checkbox"]');
          const text = li.querySelector('.left span').textContent;
          const dueDateSpan = li.querySelector('.dueDate');
          const dueDate = dueDateSpan
            ? dueDateSpan.textContent.replace(/[ï¼ˆï¼‰ã€œ]/g, '')
            : '';
          const isDone = checkbox.checked;

          // liãã‚Œãã‚Œã®classListã‹ã‚‰å„ªå…ˆåº¦ã‚’æŠ½å‡ºã™ã‚‹
          const priorityClass = Array.from(li.classList).find((cls) =>
            cls.startsWith('priority-')
          );
          const priority = priorityClass
            ? priorityClass.replace('priority-', '')
            : 'normal';

          taskData.push({ text, dueDate, isDone, priority });
        });

        localStorage.setItem('tasks', JSON.stringify(taskData));
      }

      // å¾©å…ƒé–¢æ•°ï¼ˆã‚¿ã‚¹ã‚¯ã‚’å†è¡¨ç¤ºï¼‰
      function restoreTasksFromLocalStorage() {
        const saved = localStorage.getItem('tasks');
        if (!saved) return;

        const taskArray = JSON.parse(saved);
        // ãƒ‘ãƒ¼ã‚¹ç¢ºèªï¼ˆã¾ãšã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ç¢ºèªï¼‰
        console.log('å¾©å…ƒãƒ‡ãƒ¼ã‚¿ï¼š', taskArray);
        // dueDate ã‚’åŸºæº–ã«æ—¥ä»˜æ˜‡é †ã§ä¸¦ã³æ›¿ãˆã‚‹
        taskArray.sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));
        renderTasks(taskArray);
        // Clear Completedãƒœã‚¿ãƒ³ã®è¡¨ç¤ºè¨­å®š
        updateClearCompletedVisibility();

        // taskArray.forEach((item) => {
        //   taskInput.value = item.text;
        //   document.getElementById('dueDate').value = item.dueDate;
        //   addTask(item.text, item.dueDate, item.isDone); // æ—¢å­˜ã®addTask()ã‚’åˆ©ç”¨ã—ã¦UIã‚’ç”Ÿæˆ
        // });
      }

      function renderTasks(taskArray) {
        taskList.innerHTML = '';
        taskArray.forEach((item) => {
          addTask(item.text, item.dueDate, item.isDone, item.priority); // æ—¢å­˜ã®addTask()ã‚’åˆ©ç”¨ã—ã¦UIã‚’ç”Ÿæˆ
        });
      }

      function sortTasks(order = 'asc') {
        const saved = localStorage.getItem('tasks');
        if (!saved) return;

        const taskArray = JSON.parse(saved);
        if (order === 'asc') {
          taskArray.sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));
        } else {
          taskArray.sort((a, b) => new Date(b.dueDate) - new Date(a.dueDate));
        }
        renderTasks(taskArray);

        // ãƒ•ã‚£ãƒ«ã‚¿ã‚’å†é©ç”¨
        pressFilterButtons(currentFilterType);
      }

      function fadeAndRemove(li, callbackAfterRemove) {
        li.classList.add('fading');
        setTimeout(() => {
          li.remove();
          if (typeof callbackAfterRemove === 'function') {
            callbackAfterRemove();
          }
        }, 300);
      }

      function updateClearCompletedVisibility() {
        const completedTasks = document.querySelectorAll(
          '#taskList li.completed'
        );
        if (completedTasks.length > 0) {
          clearCompletedBtn.classList.remove('hidden');
        } else {
          clearCompletedBtn.classList.add('hidden');
        }
        //   clearCompletedBtn.style.display = 'inline-block';
        // } else {
        //   clearCompletedBtn.style.display = 'none';
        // }
      }

      function validateTaskInput(taskText, dueDate) {
        const errorMsg = document.getElementById('errorMsg');
        // æœŸé™æ—¥ä»˜ã®å–å¾—ã¨ãƒã‚§ãƒƒã‚¯
        if (!dueDate) {
          errorMsg.textContent = 'âš ï¸ æœŸé™æ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„';
          errorMsg.style.display = 'block';
          return false;
        }

        // æœŸé™æ—¥ã®å…¥åŠ›å¿…é ˆãƒã‚§ãƒƒã‚¯ã‚’åˆæœŸåŒ–
        errorMsg.textContent = '';
        errorMsg.style.display = 'none';
        return true;
      }

      // æœŸé™æ—¥ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ—¥ä»˜ï¼ˆç¾åœ¨æ—¥ä»˜ï¼‰ã‚’å–å¾—ã™ã‚‹
      function getTodayDate() {
        const today = new Date();
        const yyyy = today.getFullYear();
        const mm = String(today.getMonth() + 1).padStart(2, '0');
        const dd = String(today.getDate()).padStart(2, '0');
        return `${yyyy}-${mm}-${dd}`;
      }
    </script>
  </body>
</html>
